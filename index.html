<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediControl - Gestión de Dependientes</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script type="text/babel">
        const { useState } = React;
        
        // Iconos SVG
        const Users = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
            </svg>
        );

        const Plus = ({ size = 20 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
        );

        const Edit = ({ size = 20 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
        );

        const Trash = ({ size = 20 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="3 6 5 6 21 6"/>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                <line x1="10" y1="11" x2="10" y2="17"/>
                <line x1="14" y1="11" x2="14" y2="17"/>
            </svg>
        );

        const X = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
        );

        const Calendar = ({ size = 20 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/>
                <line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
        );

        const User = ({ size = 20 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
            </svg>
        );

        const CheckCircle = ({ size = 20 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <polyline points="22 4 12 14.01 9 11.01"/>
            </svg>
        );

        const AlertCircle = ({ size = 20 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="8" x2="12" y2="12"/>
                <line x1="12" y1="16" x2="12.01" y2="16"/>
            </svg>
        );

        const DependentsApp = () => {
            const [dependents, setDependents] = useState([
                { id: 1, name: 'Juan Pérez', rut: '12.345.678-9', birthDate: '2015-05-15', sex: 'M', relation: 'Hijo' },
                { id: 2, name: 'María Pérez', rut: '23.456.789-0', birthDate: '2018-08-22', sex: 'F', relation: 'Hija' },
                { id: 3, name: 'Carlos Pérez', rut: '34.567.890-1', birthDate: '1975-03-10', sex: 'M', relation: 'Padre' }
            ]);

            const [showModal, setShowModal] = useState(false);
            const [editingDependent, setEditingDependent] = useState(null);
            const [formData, setFormData] = useState({
                name: '',
                rut: '',
                birthDate: '',
                sex: 'M',
                relation: ''
            });
            const [notification, setNotification] = useState({ show: false, message: '', type: '' });

            const formatRut = (value) => {
                const cleaned = value.replace(/[^\dkK]/g, '');
                if (cleaned.length <= 1) return cleaned;
                
                const body = cleaned.slice(0, -1);
                const dv = cleaned.slice(-1);
                
                const formatted = body.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
                return `${formatted}-${dv}`;
            };

            const handleRutChange = (e) => {
                const value = e.target.value;
                if (value.length <= 12) {
                    setFormData({ ...formData, rut: formatRut(value) });
                }
            };

            const showNotification = (message, type) => {
                setNotification({ show: true, message, type });
                setTimeout(() => {
                    setNotification({ show: false, message: '', type: '' });
                }, 3000);
            };

            const openModal = (dependent = null) => {
                if (dependent) {
                    setEditingDependent(dependent);
                    setFormData(dependent);
                } else {
                    setEditingDependent(null);
                    setFormData({ name: '', rut: '', birthDate: '', sex: 'M', relation: '' });
                }
                setShowModal(true);
            };

            const closeModal = () => {
                setShowModal(false);
                setEditingDependent(null);
                setFormData({ name: '', rut: '', birthDate: '', sex: 'M', relation: '' });
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                
                if (!formData.name || !formData.rut || !formData.birthDate || !formData.relation) {
                    showNotification('Por favor completa todos los campos', 'error');
                    return;
                }

                if (editingDependent) {
                    setDependents(dependents.map(dep => 
                        dep.id === editingDependent.id ? { ...formData, id: dep.id } : dep
                    ));
                    showNotification('Dependiente actualizado exitosamente', 'success');
                } else {
                    const newDependent = {
                        ...formData,
                        id: Date.now()
                    };
                    setDependents([...dependents, newDependent]);
                    showNotification('Dependiente agregado exitosamente', 'success');
                }
                
                closeModal();
            };

            const handleDelete = (id) => {
                if (window.confirm('¿Estás seguro de eliminar este dependiente?')) {
                    setDependents(dependents.filter(dep => dep.id !== id));
                    showNotification('Dependiente eliminado', 'success');
                }
            };

            const calculateAge = (birthDate) => {
                const today = new Date();
                const birth = new Date(birthDate);
                let age = today.getFullYear() - birth.getFullYear();
                const monthDiff = today.getMonth() - birth.getMonth();
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                    age--;
                }
                return age;
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50">
                    {/* Header */}
                    <div className="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6 shadow-lg">
                        <div className="max-w-7xl mx-auto">
                            <div className="flex items-center gap-3 mb-2">
                                <Users size={32} />
                                <h1 className="text-3xl font-bold">Gestión de Dependientes</h1>
                            </div>
                            <p className="text-blue-100">Administra la información de tus familiares a cargo</p>
                        </div>
                    </div>

                    {/* Notification */}
                    {notification.show && (
                        <div className="fixed top-4 right-4 z-50 animate-slide-in">
                            <div className={`rounded-xl shadow-lg p-4 flex items-center gap-3 ${
                                notification.type === 'success' ? 'bg-green-50 border-2 border-green-200' : 'bg-red-50 border-2 border-red-200'
                            }`}>
                                <div className={notification.type === 'success' ? 'text-green-600' : 'text-red-600'}>
                                    {notification.type === 'success' ? <CheckCircle /> : <AlertCircle />}
                                </div>
                                <p className={`font-medium ${notification.type === 'success' ? 'text-green-800' : 'text-red-800'}`}>
                                    {notification.message}
                                </p>
                            </div>
                        </div>
                    )}

                    {/* Main Content */}
                    <div className="max-w-7xl mx-auto p-6">
                        {/* Stats */}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div className="bg-white rounded-2xl shadow-lg p-6 border-l-4 border-blue-500">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-gray-600 text-sm font-medium">Total Dependientes</p>
                                        <p className="text-3xl font-bold text-gray-800 mt-2">{dependents.length}</p>
                                    </div>
                                    <div className="bg-blue-100 rounded-full p-4">
                                        <Users size={32} className="text-blue-600" />
                                    </div>
                                </div>
                            </div>

                            <div className="bg-white rounded-2xl shadow-lg p-6 border-l-4 border-purple-500">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-gray-600 text-sm font-medium">Menores de Edad</p>
                                        <p className="text-3xl font-bold text-gray-800 mt-2">
                                            {dependents.filter(d => calculateAge(d.birthDate) < 18).length}
                                        </p>
                                    </div>
                                    <div className="bg-purple-100 rounded-full p-4">
                                        <User size={32} className="text-purple-600" />
                                    </div>
                                </div>
                            </div>

                            <div className="bg-white rounded-2xl shadow-lg p-6 border-l-4 border-pink-500">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-gray-600 text-sm font-medium">Adultos</p>
                                        <p className="text-3xl font-bold text-gray-800 mt-2">
                                            {dependents.filter(d => calculateAge(d.birthDate) >= 18).length}
                                        </p>
                                    </div>
                                    <div className="bg-pink-100 rounded-full p-4">
                                        <User size={32} className="text-pink-600" />
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Add Button */}
                        <div className="mb-6">
                            <button
                                onClick={() => openModal()}
                                className="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-4 rounded-xl font-semibold shadow-lg hover:shadow-xl transition duration-300 transform hover:scale-105 flex items-center gap-2"
                            >
                                <Plus />
                                Agregar Nuevo Dependiente
                            </button>
                        </div>

                        {/* Dependents Grid */}
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {dependents.map(dep => (
                                <div key={dep.id} className="bg-white rounded-2xl shadow-lg hover:shadow-xl transition duration-300 overflow-hidden">
                                    <div className="bg-gradient-to-r from-blue-500 to-purple-500 p-4 text-white">
                                        <div className="flex items-center gap-3">
                                            <div className="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center text-2xl font-bold backdrop-blur-sm">
                                                {dep.name.charAt(0)}
                                            </div>
                                            <div>
                                                <h3 className="font-bold text-lg">{dep.name}</h3>
                                                <p className="text-sm text-blue-100">{dep.relation}</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div className="p-4 space-y-3">
                                        <div className="flex items-center gap-2 text-gray-700">
                                            <User size={16} />
                                            <span className="text-sm"><strong>RUT:</strong> {dep.rut}</span>
                                        </div>
                                        
                                        <div className="flex items-center gap-2 text-gray-700">
                                            <Calendar size={16} />
                                            <span className="text-sm">
                                                <strong>Edad:</strong> {calculateAge(dep.birthDate)} años
                                            </span>
                                        </div>
                                        
                                        <div className="flex items-center gap-2 text-gray-700">
                                            <span className="text-sm">
                                                <strong>Sexo:</strong> {dep.sex === 'M' ? 'Masculino' : 'Femenino'}
                                            </span>
                                        </div>
                                        
                                        <div className="flex items-center gap-2 text-gray-700">
                                            <span className="text-sm">
                                                <strong>F. Nacimiento:</strong> {new Date(dep.birthDate).toLocaleDateString('es-CL')}
                                            </span>
                                        </div>

                                        <div className="flex gap-2 pt-3 border-t">
                                            <button
                                                onClick={() => openModal(dep)}
                                                className="flex-1 flex items-center justify-center gap-2 py-2 bg-blue-50 text-blue-600 rounded-lg font-medium hover:bg-blue-100 transition"
                                            >
                                                <Edit size={18} />
                                                Editar
                                            </button>
                                            <button
                                                onClick={() => handleDelete(dep.id)}
                                                className="flex-1 flex items-center justify-center gap-2 py-2 bg-red-50 text-red-600 rounded-lg font-medium hover:bg-red-100 transition"
                                            >
                                                <Trash size={18} />
                                                Eliminar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>

                        {dependents.length === 0 && (
                            <div className="bg-white rounded-2xl shadow-lg p-12 text-center">
                                <Users size={64} className="mx-auto text-gray-300 mb-4" />
                                <h3 className="text-xl font-bold text-gray-800 mb-2">No hay dependientes registrados</h3>
                                <p className="text-gray-600 mb-6">Comienza agregando tu primer dependiente</p>
                                <button
                                    onClick={() => openModal()}
                                    className="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-xl font-semibold shadow-lg hover:shadow-xl transition"
                                >
                                    Agregar Dependiente
                                </button>
                            </div>
                        )}
                    </div>

                    {/* Modal */}
                    {showModal && (
                        <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50 backdrop-blur-sm">
                            <div className="bg-white rounded-3xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                                <div className="sticky top-0 bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6 rounded-t-3xl">
                                    <div className="flex items-center justify-between">
                                        <h2 className="text-2xl font-bold">
                                            {editingDependent ? 'Editar Dependiente' : 'Agregar Nuevo Dependiente'}
                                        </h2>
                                        <button
                                            onClick={closeModal}
                                            className="p-2 hover:bg-white/20 rounded-lg transition"
                                        >
                                            <X />
                                        </button>
                                    </div>
                                </div>

                                <div className="p-6">
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-gray-700 font-medium mb-2">
                                                Nombre Completo *
                                            </label>
                                            <input
                                                type="text"
                                                value={formData.name}
                                                onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                                                placeholder="Ej: Juan Pérez González"
                                                className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-gray-700 font-medium mb-2">
                                                RUT *
                                            </label>
                                            <input
                                                type="text"
                                                value={formData.rut}
                                                onChange={handleRutChange}
                                                placeholder="12.345.678-9"
                                                className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-gray-700 font-medium mb-2">
                                                Fecha de Nacimiento *
                                            </label>
                                            <input
                                                type="date"
                                                value={formData.birthDate}
                                                onChange={(e) => setFormData({ ...formData, birthDate: e.target.value })}
                                                className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-gray-700 font-medium mb-2">
                                                Sexo *
                                            </label>
                                            <select
                                                value={formData.sex}
                                                onChange={(e) => setFormData({ ...formData, sex: e.target.value })}
                                                className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition"
                                            >
                                                <option value="M">Masculino</option>
                                                <option value="F">Femenino</option>
                                            </select>
                                        </div>

                                        <div>
                                            <label className="block text-gray-700 font-medium mb-2">
                                                Relación/Parentesco *
                                            </label>
                                            <select
                                                value={formData.relation}
                                                onChange={(e) => setFormData({ ...formData, relation: e.target.value })}
                                                className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition"
                                            >
                                                <option value="">Seleccionar...</option>
                                                <option value="Hijo">Hijo/a</option>
                                                <option value="Padre">Padre</option>
                                                <option value="Madre">Madre</option>
                                                <option value="Esposo">Esposo/a</option>
                                                <option value="Hermano">Hermano/a</option>
                                                <option value="Abuelo">Abuelo/a</option>
                                                <option value="Otro">Otro</option>
                                            </select>
                                        </div>

                                        <div className="flex gap-3 pt-4">
                                            <button
                                                onClick={handleSubmit}
                                                className="flex-1 bg-gradient-to-r from-blue-600 to-purple-600 text-white py-4 rounded-xl font-semibold shadow-lg hover:shadow-xl transition duration-300"
                                            >
                                                {editingDependent ? 'Guardar Cambios' : 'Agregar Dependiente'}
                                            </button>
                                            <button
                                                onClick={closeModal}
                                                className="px-6 py-4 bg-gray-100 text-gray-700 rounded-xl font-semibold hover:bg-gray-200 transition"
                                            >
                                                Cancelar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<DependentsApp />);
    </script>

    <style>
        @keyframes slide-in {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        .animate-slide-in {
            animation: slide-in 0.3s ease-out;
        }
    </style>
</body>
</html>
